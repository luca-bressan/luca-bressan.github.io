<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Some facts about barrier options</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/base16/rebecca.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/matlab.min.js"></script>
    <script>hljs.highlightAll();</script>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="My finance & statistics blog" />
    <link rel="shortcut icon" href="https://luca-bressan.github.io/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://luca-bressan.github.io/about-barrier-options" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Luca Bressan - finance & statistics" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Some facts about barrier options" />
    <meta property="og:description" content="Cover photo by T L. Arguably, a dam is a down-and-out type of barrier, although not the kind we‚Äôre interested in. What you should know before reading this post: Fundamentals of option pricing in the Black-Scholes model. Fundamentals of stochastic calculus. About barrier options and other related contracts Let‚Äôs be" />
    <meta property="og:url" content="https://luca-bressan.github.io/about-barrier-options" />
    <meta property="og:image" content="https://luca-bressan.github.io/assets/images/about-barrier-options/barrier.jpg" />
    <meta property="article:publisher" content="https://www.linkedin.com/in/lbressan" />
    <meta property="article:author" content="https://www.linkedin.com/inlbressan" />
    <meta property="article:published_time" content="2022-10-10T12:18:00+02:00" />
    <meta property="article:modified_time" content="2022-10-10T12:18:00+02:00" />
    <meta property="article:tag" content="Derivatives" />
    
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <!-- for mathjax support -->
    
      <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          CommonHTML: { linebreaks: { automatic: true } },
          "HTML-CSS": { linebreaks: { automatic: true } },
                 SVG: { linebreaks: { automatic: true } }
        });
        </script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Luca Bressan - finance & statistics",
        "logo": "https://luca-bressan.github.io/assets/images/blog-icon.png"
    },
    "url": "https://luca-bressan.github.io/about-barrier-options",
    "image": {
        "@type": "ImageObject",
        "url": "https://luca-bressan.github.io/assets/images/about-barrier-options/barrier.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://luca-bressan.github.io/about-barrier-options"
    },
    "description": "Cover photo by T L. Arguably, a dam is a down-and-out type of barrier, although not the kind we‚Äôre interested in. What you should know before reading this post: Fundamentals of option pricing in the Black-Scholes model. Fundamentals of stochastic calculus. About barrier options and other related contracts Let‚Äôs be"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Some facts about barrier options" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://luca-bressan.github.io/"><img src="/assets/images/blog-icon.png" alt="Luca Bressan - finance & statistics" /></a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <!--<li class="nav-getting-started" role="menuitem"><a href="/tag/getting-started/">Getting Started</a></li>-->
    <!--<li class="nav-try-ghost" role="menuitem"><a href="https://ghost.org">Try Ghost</a></li>-->
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-derivatives post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="10 October 2022">10 October 2022</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/derivatives/'>DERIVATIVES</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Some facts about barrier options</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/about-barrier-options/barrier.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>Cover photo by <a href="https://unsplash.com/photos/plbeyaME7Jk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink">T L</a>. Arguably, a dam is a down-and-out type of barrier, although not the kind we‚Äôre interested in.</p>

<h3 id="what-you-should-know-before-reading-this-post">What you should know before reading this post:</h3>

<ul>
  <li>Fundamentals of option pricing in the <em>Black-Scholes</em> model.</li>
  <li>Fundamentals of stochastic calculus.</li>
</ul>

<h1 id="about-barrier-options-and-other-related-contracts">About barrier options and other related contracts</h1>
<p>Let‚Äôs be honest: option pricing is not an easy feat to begin with, and the work of Black and Scholes is nothing short of magic. Today we are going to face the issue of options with path-dependent payoffs, in particular we are going to take a look at single, fixed barrier options and lookbacks. We will introduce some mathematical results that allow us to think more <em>financially</em> when dealing with the pricing problem, instead of getting bogged down in the maths of it. We will test some of our results with a Monte Carlo estimate, checking whether the closed form formula agrees with simulations. I suggest that you read this on a decently sized screen: MathJax is notoriously mobile-unfriendly. Rotating your device in landscape mode may help with long formulas and equations. Take a deep breath, it‚Äôs going to be kind of intenseüòÇ.</p>

<p>Let‚Äôs begin!</p>

<h3 id="a-closer-look-at-the-black-scholes-equation">A closer look at the <em>Black-Scholes</em> equation</h3>
<p>It‚Äôs easy to lose sight of the target when dealing with an option pricing problem. That is, many forget that the option pricing problem <em>is <strong>not</strong> about find the general integral of the parabolic PDE that is the Black-Scholes equation</em>, but it <em>is about finding <strong>the unique solution to a boundary constraint problem</strong></em>. Why does this matter so much?
Let‚Äôs introduce the <strong>Black-Scholes PDE operator</strong>: for each suitable function \(f\), let \(\mathfrak{d}_{\sigma,r}(f)\) be the operator that returns the function</p>

<p>\begin{equation}
              \mathfrak{d}_{\sigma,r}(f) := \frac{\partial f}{\partial t} + \frac{1}{2} \sigma^2 x^2 \frac{\partial^2 f}{\partial x^2} + rx \frac{\partial f}{\partial x} - rf
\end{equation}</p>

<p>One might see that \(\mathfrak{d}_{\sigma,r}(f)\) is a linear operator. This is of fundamental importance to our goal: two different solutions to our <em>PDE</em> can be combined to get a new one. Should we be able to combine different solutions to the equation to satisfy the boundary condition, we would be successful in solving the option pricing problem. Let‚Äôs introduce the crucial tools that will allow us to exploit this property.</p>

<blockquote>
  <h6 id="proposition">Proposition.</h6>
  <p>Let
\begin{equation}
\frac{dX}{X} = \mu dt + \sigma dW_{t}
\end{equation}
be the dynamic of a geometric brownian motion under a suitable probability measure. Then there exists a number \(\alpha\) such that \(X^{\alpha}\) is a martingale under the same probability measure.</p>
</blockquote>

<h6 id="proof-sketch">Proof sketch.</h6>

<p>The appropriate \(\alpha\) is \(\alpha = 1 - \frac{2 \mu}{\sigma^2}\). From here one should use Ito‚Äôs formula on \(X^{\alpha}\) and see that the resulting dynamic is one of a martingale.</p>

<p style="text-align: right">‚àé</p>

<p>This result is going to be crucial in the next proof. We still need some preliminary work before diving into barrier option pricing.</p>

<blockquote>
  <h6 id="definition-contract-function">Definition. <em>(Contract function)</em></h6>
  <p>A <em>contract function</em> \(\Phi_{A_{T}}\) on some asset \(A_{t}\) is a generic function of at least asset price and time of expiration. For our intents and purposes, it will represent exactly the value of a given contract at expiration.</p>
</blockquote>

<p>Our contract functions unfortunately won‚Äôt be just function of asset price and time of expiration. They will be functions of the asset path as well, that is they will be functions of \(A_{t}\) for some \(t&lt;T\). This is what we mean when we talk about path-dependency.</p>

<blockquote>
  <h6 id="definition-pricing-function-price-function">Definition. <em>(Pricing function, price function)</em></h6>
  <p>A <em>pricing function</em> \(\pi_{\Phi_{A_{T}}, t}\) on some contract \(\Phi_{A_{T}}\) is a function that gives the no-arbitrage price of said contract at any time before expiration.</p>
</blockquote>

<p>Sometimes I won‚Äôt be as pedantic when using notation. No need to be as long as we‚Äôre understating each other. Be flexible!</p>

<blockquote>
  <h6 id="theorem-principle-of-reflection">Theorem. <em>(Principle of Reflection)</em></h6>
  <p>Let \(\Phi_{S_{T}}\) be a contract function on some asset \(S_{t}\) that follows a GBM dynamic in a complete market free of arbitrages, and let \(\pi_{\Phi_{S_{T}}, t}\) be the associated pricing function that solves the <em>Black-Scholes PDE</em> \(\mathfrak{d}_{\sigma,r} ( \pi_{\Phi_{S_{T}}, t} ) = 0\).
Let \(H&gt;0\) and let \(\alpha\) be the number such that \(S^{\alpha}\) is a martingale under the same probability measure. Consider the contract function \(\Psi_{S_{T}}=\left( \frac{S_{T}}{H} \right) ^{\alpha} \Phi_{\frac{H^2}{S_{T}}, t}\)
Then, the associated pricing function to the new claim that solves the <em>Black-Scholes PDE</em> is 
\begin{equation}
\xi_{S_{t},t} = \left( \frac{S_{t}}{H} \right) ^{\alpha} \pi_{\Phi_{S_{T}}, t} \left( \frac{H^2}{S_{T}}, t \right) .
\end{equation}</p>
</blockquote>

<h6 id="proof">Proof.</h6>
<p>The appropriate price (that is, the pricing function that solves the Black-Scholes PDE) for \(\Psi_{S_{T}}\) given by</p>

<p>\begin{equation}
\xi=e^{-r(T-t)} \mathbb{E}^{\mathbb{Q},t} \left[ \left( \frac{S_{t}}{H} \right) ^{\alpha} \Phi_{\frac{H^2}{S_{T}}, t} \right]
\end{equation}
where \(\mathbb{Q}\) is the probability measure such that \(S_{t}^{\alpha}\) is a martingale.</p>

<p>Consider \(\Psi_{S_{T}}\) to be a contract on asset \(U_{t}=\frac{H^2}{S_{t}}\).
Then, use the abstract Bayes theorem to state that there exists a new probability measure \(\mathbb{B}\), obtainable via a Radon-Nikodym derivative, such that</p>

<p>\begin{equation}
\xi \left( \frac{S_{t}}{H} \right) ^{- \alpha} = e^{-r(T-t)} \mathbb{E}^{\mathbb{B},t} \left[ \Phi_{U_{T},T} \right]
\end{equation}</p>

<p>Furthermore, the following can be stated:</p>
<ul>
  <li>\(dW^{\mathbb{B}}=dW^{\mathbb{Q}}-\alpha \sigma dt\).</li>
  <li>\(U\) has \(\mathbb{B}\)-dynamic \(\frac{dU}{U} = \mu dt - \sigma dW^{\mathbb{B}}\)</li>
</ul>

<p>Since the \(\mathbb{B}\)-dynamic of \(U_{t}\) and the \(\mathbb{Q}\)-dynamic of \(S_{t}\) are equivalent <strong>as the minus sign in front of the brownian differential does not impact the distribution</strong>, we may state that the right-hand side of the pricing equation is exactly \(\pi\) evaluated for the desired arguments. Multiply then both sides by \(\left( \frac{S_{t}}{H} \right) ^{\alpha}\) to conclude the proof.</p>

<p style="text-align: right">‚àé</p>

<p>Let‚Äôs add some remarks on this proof. Some of the readers might be familiar with other names for the abstract Bayes‚Äô theorem: for example it is also called <em>change of numerary theorem</em>, and those who are familiar with the Black‚Äôs formula for futures pricing are also aware of its immense versatility. It can be used to prove other pricing formulas, like Margrabe‚Äôs formula for exchange options. Furthermore, we are assuming constant volatility, constant risk-free rate and no dividend yield. While accounting for deterministically varying dividends, rates and volatility is relatively easy (see <a href="#bibliography-and-further-reading">Bj√∂rk</a>), accounting for random variations in this parameters is much more tedious and may preclude the possibility of finding a closed form for the prices (see <a href="#bibliography-and-further-reading">Google Scholar: pricing options under the Vasicek interest rate model</a>).</p>

<p>Let‚Äôs move on: why did we bother with the reflection theorem in the first place? The assets \(S_{t}\) and \(U_{t}\) have a peculiar property: they are always on opposite sides of the number \(H\), and they match when \(S_{t}=H\). By this point you may have already correctly guessed that \(H\) is our barrier. But this is where the real magic happens: consider a vanilla call option struck at \(K\). The reflection principle allows us to synthesize a new contract <em>(from now on called reflected)</em> that has the exact same price of the original one when \(S_{t}=H\), independently of time. This is the key point of what we‚Äôre about to do.</p>

<h3 id="pricing-a-down-and-out-regular-call-option">Pricing a down-and-out regular call option</h3>
<p>Consider a down-and-out call option struck at \(K\) where the barrier \(H\) is out-of-the-money <em>(this last condition is what distinguishes regular barrier options from reverse barrier options)</em>. The pricing problem is a boundary constrained problem, built on the <em>Black-Scholes PDE</em>. The constraints are:</p>

<ul>
  <li>terminal pricing condition: the price at expiry must match the payoff of the contract;</li>
  <li>lack-of-optionality condition: when the asset price is very high, our option must be treated more and more like a futures contract, since the benefit they provide is equivalent;</li>
  <li>barrier condition: whenever the underlying asset touches the barrier, the option ceases to exist, turning into nothingness. And nothing has no value.</li>
</ul>

<p>We claim that a portfolio made by going long on a vanilla call with strike \(K\) and going short on the reflection of such call option is going to provide the solution to our pricing problem:</p>

<ul>
  <li>at t=T, our reflected call is always going to be out-of-the-money, as the barrier was not touched. One can see that by observing that \(\frac{H^2}{S_{T}} &lt; \frac{H^2}{H} = H &lt; K\). This means that the portfolio value is entirely given by our vanilla call, as intended;</li>
  <li>as \(S_{t}\) goes to infinity, so \(\frac{H^2}{S_{T}}\) goes to zero, meaning the the reflected call has negligible value and our portfolio inherits its lack-of-optionality from the vanilla call;</li>
  <li>independently of time, whenever \(S_{t}\) equals \(H\) the reflected call value cancels out the vanilla call value, giving a net value to the portfolio equal to zero.</li>
</ul>

<p>An important consideration must be added: our process works under the assumption that our contract function has an indicator function to nullify its value whenever the barrier is touched. In symbols, we are assuming our contract function to look like this \(\xi_{(...)} = \tilde{\xi}_{(...)} \mathbb{1}_{\lbrace \forall t : S_{t}&gt;H \rbrace}\): this is what allows us not to worry about what happens when \(S_{t}\) is below the barrier.</p>

<p>We can now state what the price for this barrier option is:</p>

<p>\begin{equation}
C^{DOC,regular} (S_{t}, t, \sigma, r, H, K) = C^{vanilla} \left( S_{t}, t, \sigma, r, K \right) \mathbb{1}_{ \left\lbrace S_{t}&gt;H \right\rbrace } (S_{t}) - \left( \frac{S_{t}}{H} \right)^{\alpha} C^{vanilla} \left( \frac{H^2}{S_{t}}, t, \sigma, r, K \right) \mathbb{1}_{ \left\lbrace S_{t}&gt;H \right\rbrace } (S_{t})
\end{equation}</p>

<p>Unsurprisingly, we observe that the barrier clause generates a discount on the final price.</p>

<figure style="display: inline-block; text-align: center; align-content:center; position: relative; float: left; overflow: hidden; margin: 0 20px 20px 0; max-width: 920px;">
  <img src="/assets/images/about-barrier-options/price_animation.gif" alt="Price evolution" style="max-width: 100%; height: auto;" />
  <figcaption style="position: absolute; text-align: center; align-content:center; background: rgba(0,0,0,0.75); color: white; padding: 10px 20px; opacity: 1; bottom: 0; font-size: 12px; line-height: 18px;">Evolution of price functions for a plain vanilla call (in yellow) and a DOC regular option (in blue). Notice how the blue line always lies below the yellow line. In red, the payoff at maturity.</figcaption>
</figure>

<h3 id="pricing-a-down-and-out-reverse-call">Pricing a down-and-out reverse call</h3>

<p>When the barrier is in-the-money, our barrier condition is no longer satisfied if we just use the previous approach. We need to make some minor alterations to the options portfolio we intend to reflect. We should build a portfolio of derivatives whose value is zero at the barrier, while having exactly the value of a vanilla call option whenever the underlying asset price is higher. This is obtained by going long on one vanilla call struck at \(H\) and \(H-K\) units of a digital call also struck at \(H\). Reflect this portfolio to obtain the following pricing formula:</p>

<p>\begin{equation}
C^{DOC,reverse} (S_{t}, t, \sigma, r, H, K) = C^{vanilla} \left( S_{t}, t, \sigma, r, H \right) \mathbb{1}_{ \left\lbrace S_{t}&gt;H \right\rbrace } (S_{t}) + (H-K) C^{digital} \left( S_{t}, t, \sigma, r, H \right) \mathbb{1}_{ \left\lbrace S_{t}&gt;H \right\rbrace } (S_{t}) - \left( \frac{S_{t}}{H} \right)^{\alpha} C^{vanilla} \left( \frac{H^2}{S_{t}}, t, \sigma, r, H \right) \mathbb{1}_{ \left\lbrace S_{t}&gt;H \right\rbrace } (S_{t}) - (H-K) \left( \frac{S_{t}}{H} \right)^{\alpha} C^{digital} \left( \frac{H^2}{S_{t}}, t, \sigma, r, H \right) \mathbb{1}_{ \left\lbrace S_{t}&gt;H \right\rbrace } (S_{t})
\end{equation}</p>

<figure style="display: inline-block; text-align: center; align-content:center; position: relative; float: left; overflow: hidden; margin: 0 20px 20px 0; max-width: 920px;">
  <img src="/assets/images/about-barrier-options/payoff_truncation.jpg" alt="reflected portfolio" style="max-width: 100%; height: auto;" />
  <figcaption style="position: absolute; text-align: center; align-content:center; background: rgba(0,0,0,0.75); color: white; padding: 10px 20px; opacity: 1; bottom: 0; font-size: 12px; line-height: 18px;">Maturity payoff of the truncated portfolio. Solid red line indicates the contract function, dashed black line indicates the barrier threshold and dot-dashed blue line indicates the strike price of the option. </figcaption>
</figure>

<h3 id="in-out-parities">In-Out parities</h3>

<p>Whenever a portfolio is made up of knock-out barrier option and the respective knock-in counterpart, the resulting portfolio is a plain vanilla option of the same type. While this is intuitively clear, a quick algebraic manipulation shows that this fact is also mathematically correct. Feel free to have a try proving this, it‚Äôs easy. It is just a matter of being careful with indicator functions algebra. This allows us to price the knock-in contracts given the knock-out price and viceversa.</p>

<h3 id="pricing-an-up-and-out-regular-put-and-pretty-much-anything-else">Pricing an up-and-out regular put, and pretty much anything else</h3>

<p>The reflection principle is still our primary tool when it comes to pricing up contracts. Our approach is still valid even with our new boundary constraints. Namely, our <em>spatial constraints</em> define a bounded region in the set of possible \(S_{t}\) values (the term <em>spatial constraint</em> comes from <a href="#conclusions">thermodynamics</a>). What we did by imposing the knock-out clause is essentialy setting an upper bound to the values that \(S_{t}\) can take without nullifying our contract. A lower bound was already present, since in our model asset prices cannot be negative. It is left to the reader to try out every possibile combination of put, call, knock-in, knock-out regular and reverse contract. This approach applies to pretty much every contract function as long as the barrier is unique and fixed. Let‚Äôs close this discussion with a quick question:</p>

<blockquote>
  <p>There are barrier contracts which are exactly equivalent to their vanilla counterparts, which ones? <em>Think of barrier contracts which have zero value no matter the time to expiration or the value of the underlying</em>.</p>
</blockquote>

<h3 id="testing-our-formulas">Testing our formulas</h3>

<p>It would be rather useful to check whether our previous work is correct by comparing it with something that is certainly correct. We shall do this by comparing the result of our formulas with the result of a Monte Carlo estimation. Our simulation will be done using <code class="language-plaintext highlighter-rouge">MATLAB</code>.
Consider an hypotethical asset-market combination with the following properties: \(S_{0}=100 \$\), \(r=2.5 \%\), \(\sigma = 20\%\). We will try pricing a down-and-out regular call with \(H=95\), \(T=1\) and \(K=102.5 \$\). It is essentially an ATMF call option with a knock-out clause. We will simulate 30000 paths: unfortunately Monte Carlo methods are slow to converge. Let‚Äôs take a look at the <code class="language-plaintext highlighter-rouge">MATLAB</code> code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>          % Pricing parameters
          mu = 0.025;
          sigma = 0.2;
          s_0 = 100;
          deltaTime=1/(252*8*12);
          numDataPoints=252*8*12;
          numPaths=30000;
          K=102.5;
          H=95;
          alpha=1-2*(mu/(sigma^2));

          % Asset paths simulation
          asset = gbm(mu,sigma,'StartState',s_0);
          tic;
          [X, T] = asset.simByEuler(numDataPOints, 'DeltaTime', deltaTime, 'nTrials', numPaths);
          toc
          assetPaths=zeros(numDataPoints+1,numPaths);
          for i=1:numPaths
                        assetPaths(:,i)=X(:,:,i);
          end

          % Option price estimation
          optionSimulatedPayoffs=zeros(1,numPaths);
          for k=1:numPaths
                        if min(assetPaths(:,k))&lt;=H
                                      optionSimulatedPayoffs(k)=0;
                        else
                                      optionSimulatedPayoffs=max(assetPaths(end,k)-K, 0);
                        end
          end

          optionEstimatedPrice=exp(-mu)*mean(optionSimulatedPayoffs);
          optionExactPrice=blsprice(s_0,K,mu,1,sigma) - ((s_0/H)^alpha).*blsprice(H^2/s_0,K,mu,1,sigma);
</code></pre></div></div>

<p>The code is very much self explainatory, and for details about stochastic processes simulation one should refer to the official documentation by MathWorks. One might wonder why the number of data points is such that we are considering observations taken every quarter of an hour over a day (or taken every five minutes over an 8-hours working day). If we were to consider observations taken at the end of each trading day, we would be giving an overly optimistic and biased estimate of the option price as <a href="#bibliography-and-further-reading">we would be discarding effects due to intraday volatility</a>. To make a long story short, our asset may breach the barrier in between observation points, and we wouldn‚Äôt be able to notice that. 
Our estimated price is \(V=4.39(8)\$\). Assuming an approximately normal distribution for the estimator <em>(can you spot any issues with this?)</em> we get a standard error of \(0.06(8) \$\) and our theoretical price of \(4.34(5) \$\) is within the 95% confidence interval of our estimation. We can conclude that our Monte-Carlo estimate and our closed-form analytical formula agree on the result to a sufficient degree that we can confidently assign a price to the option.</p>

<figure style="display: inline-block; text-align: center; align-content:center; position: relative; float: left; overflow: hidden; margin: 0 20px 20px 0; max-width: 920px;">
  <img src="/assets/images/about-barrier-options/montecarlo_paths.jpg" alt="Monte Carlo paths" style="max-width: 100%; height: auto;" />
  <figcaption style="position: absolute; text-align: center; align-content:center; background: rgba(0,0,0,0.75); color: white; padding: 10px 20px; opacity: 1; bottom: 0; font-size: 12px; line-height: 18px;">A sampling of 100 simulated asset paths. The red line marks the average of the simulated asset paths. In blue it is shown the risk-free growth of a capital equal to the spot price of the underlying. </figcaption>
</figure>

<h3 id="static-hedging-of-barrier-options">Static hedging of barrier options</h3>

<p>Once the appropriate formula for a price is found, it is natural to ask ourselves how to hedge a position involving barrier options. Unfortunately, when taking derivatives to evaluate \(\Delta\), the indicator functions induce finite jump discontinuities in the result. This means that hedging a position when the underlying is near the barrier can be extremely problematic, and static hedging techniques are out of the scope of this article. In the last 20 years the literature about solving this issue has been very abundant, so a <a href="#bibliography-and-further-reading">search on Google Scholar</a> can be a good starting point for learning more.</p>
<figure style="display: inline-block; text-align: center; align-content:center; position: relative; float: left; overflow: hidden; margin: 0 20px 20px 0; max-width: 920px;">
  <img src="/assets/images/about-barrier-options/dic.jpg" alt="DIC" style="max-width: 100%; height: auto;" />
  <figcaption style="position: absolute; text-align: center; align-content:center; background: rgba(0,0,0,0.75); color: white; padding: 10px 20px; opacity: 1; bottom: 0; font-size: 12px; line-height: 18px;">Price and delta as a function of the underlying asset price for some DIC option. Notice the cusp in the price function and discontinuity at the barrier in the delta.</figcaption>
</figure>

<h3 id="getting-creative-pricing-a-floating-strike-lookback-call">Getting creative: pricing a floating strike lookback call</h3>

<p>At the heart of our work lies the issue of path-dependency. That is, our contract function is not only a function of information known at the time of expiration, but it also depends on other times preceding the expiration. Our clever solution with reflections had the only goal of removing path-dependency from our calculations. Now we will take a look at another contract that exhibits path dependency. Floating strike lookback calls are options that allow us to buy an asset at the lowest price recorded in between issuance of the option and expiration. Our contract function looks like this:</p>

<p>\begin{equation}
\Phi = S_{T} - \min_{t= \tau} S_{\tau}
\end{equation}</p>

<p>We will obtain a pricing formula decomposing this contract in a portfolio of options that are either not path-dependent or whose path-dependency we can manage. Let \(t\) be some time before expiration. Let \(\tau(t)\) be the time where our asset reached it lowest price, that is let \(\tau(t) = \arg \min _{t} S_{t}\). Intuitively, our portfolio must start with a plain vanilla call option, struck at \(S_{\tau(t)}\), given that surely we‚Äôll have the right to buy the asset at such price. Then, our portfolio must take into account the possibility that the asset will fall even lower than \(S_{\tau(t)}\). We will add something to our portfolio that satisfies the following requirements:</p>
<ul>
  <li>we must be able to price it using reflections;</li>
  <li>no benefit must be provided at expiration if \(S_{\tau(t)} = S_{\tau(T)}\);</li>
  <li>the resulting portfolio must be a call struck at \(S_{\tau(T)}\) (i.e. our lookback option).</li>
</ul>

<p>We claim that this result can be achieved by adding infinitely many contracts, each one of them being bought in infinitesimal quantity. Consider for any \(\gamma\) lesser than \(S_{\tau(t)}\), a position obtained by going short \(d\gamma\) units of a down-and-in digital call struck at \(S_{\tau(t)}\) with barrier at \(\gamma\) and going long by the same amount on a down and in digital call struck at \(\gamma\) with barrier at \(\gamma\). Let‚Äôs check our claim:</p>
<ul>
  <li>we can price digital DICs using reflections;</li>
  <li>since any \(\gamma\) is lesser than \(S_{\tau(t)}\), if \(S_{\tau(t)} = S_{\tau(T)}\) none of our contracts are active, and the payoff is null.</li>
  <li>suppose that \(S_{T}\) is greater than \(S_{\tau(t)}\). Integrate the payoff over the active, non zero value contract region (i.e. between \(S_{\tau(t)}\) and \(S_{\tau(T)}\)): \(\int_{S_{\tau(T)}}^{S_{\tau(t)}} d\gamma = S_{\tau(t)} - S_{\tau(T)}\). Then add to our previous result the payoff of our plain vanilla call: it is \(S_{T}-S_{\tau(t)}\), and therefore we obtain the right quantity. If \(S_{T}\) is lesser than \(S_{\tau(t)}\), the above integral reduces to \(\int_{S_{\tau(T)}}^{S_{T}} d\gamma = S_{T} - S_{\tau(T)}\), and adding the null payoff of the plain vanilla call yields again the correct result.</li>
</ul>

<p>All of this allows us to state that the the price for a lookback floating strike call is given by</p>

<p>\begin{equation}
\int_0^{S_{\tau(t)}} \left( C^{DIC,digital}(S_{t}, t, \sigma, r, \gamma, \gamma) - C^{DIC,digital}(S_{t}, t, \sigma, r, \gamma, S_{\tau(t)} \right) d\gamma + C^{call}(S_{t}, t, \sigma, r, S_{\tau(t)})
\end{equation}</p>

<p>You‚Äôll be delighted to know that this integral allows for a closed form analytical solution, but solving the integral requires a certain bravery, a bit of time and a ton of paper. If you‚Äôre up for a nice integration challenge, go for it. You will find out that the solution is</p>

<p>\begin{equation}
S_{t}e^{-r(T-t)}N(d_{1})-S_{\tau(t)}e^{-r(T-t)}N(d_{2})+S_{t}e^{-r(T-t)} \sigma \sqrt{T-t} \left[ \frac{1}{\sqrt{2\pi}}  e^{- \frac{d_{1}^2}{2}}+d_{1}N(-d_{1}) \right]
\end{equation}</p>

<p>where \(N(x)\) is the standard gaussian cdf. and \(d_{1}\) and \(d_{2}\) are the usual <em>Black-Scholes quantiles</em> evaluated for \(K=S_{\tau(t)}\) and \(S=S_{t}\). This expression is somewhat more complex if we allow for the presence of dividends, but the reasoning remains the same. Again feel free to try, I‚Äôm sure you‚Äôll manage as it‚Äôs mostly a matter of making the right choices while integrating by parts.</p>

<h3 id="conclusions">Conclusions</h3>
<p>We have seen how the reflection principle allows us to get rid of path-dependency and lets us find pricing formula that would be otherwise much more tedious to evaluate. This is not the only way possible: you may want to look into the theory of absorbed processes. This is the way that these formula were first found (see <a href="#bibliography-and-further-reading">Muisela</a> and <a href="#bibliography-and-further-reading">Bj√∂rk</a>), and it is a perfecty valid one, although much more mathematically intense. The beauty of the reflection principle lies in the possibilty of being able to reason in <em>financial terms</em>, and the math just gets out of the way. This article is a good starting point, but much more can be said about path-dependent contract functions. Some possible next steps from here:</p>
<ul>
  <li>looking into more contracts, such as ladders and double barriers;</li>
  <li>looking at how things change when we have stochastic dividends and rates;</li>
  <li>looking at the classic heat diffusion model <em>(interestingly, the option pricing problem is very similar to the problem of predicting temperature evolution across an infinitely long rod)</em>, and then looking at the heat diffusion model with constant temperature zones <em>(you will find that they behave very much like our barriers)</em>.</li>
</ul>

<p>This is my first article for this blog, and my first attempt at blogging in general. Reach out to me on <a href="https://linkedin.com/in/lbressan">Linkedin</a> or <a href="https://github.com/luca-bressan">GitHub</a> if you want to suggest improvements or if you want to just have a chat about this. I hope that you enjoyed!</p>

<h3 id="bibliography-and-further-reading">Bibliography and further reading</h3>

<ul>
  <li><a href="https://scholar.google.com/scholar?hl=it&amp;as_sdt=0%2C5&amp;q=pricing+options+in+the+vasicek+model&amp;btnG=">Pricing options under the Vasicek model</a></li>
  <li><a href="https://scholar.google.com/scholar?hl=it&amp;as_sdt=0%2C5&amp;q=static+hedging+of+barrier+options&amp;btnG=">Static hedging of barrier options</a></li>
  <li>Bj√∂rk, Tomas, 2009. <em>‚ÄúArbitrage Theory in Continuous Time‚Äù</em>. Professor Bj√∂rk passed away in 2021: although I never met him, I am still very grateful for this work of his from which I learned the fundamentals of finance in continuous time. A must-read for all who aspire to work in this field.</li>
  <li><a href="https://warwick.ac.uk/fac/soc/wbs/subjects/finance/research/wpaperseries/2004/04-211.pdf">Effects of intraday volatility on Monte Carlo estimates.</a></li>
  <li>Musiela, Mark &amp; Rutkowski, Marek, 2004. <em>‚ÄúMartingale Methods in Financial Modelling‚Äù</em>.</li>
</ul>

<h3 id="updates">Updates</h3>
<ul>
  <li>12/10/2022 - Rolled back to MathJax version 2.7 to improve mobile-friendliness: TeX sections have been modified accordingly. Fixed some typos.</li>
</ul>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/luca.jpg" alt="luca" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/luca">Luca Bressan</a></h4>
                                
                                    <p>Luca is the founder of this blog. Interested in finance, maths and cars.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/luca">Read More</a>
                        </div>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://luca-bressan.github.io/">
            
                <img src="/assets/images/favicon.png" alt="Luca Bressan - finance & statistics icon" />
            
            <span>Luca Bressan - finance & statistics</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Some facts about barrier options</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Some+facts+about+barrier+options&amp;url=https://luca-bressan.github.io/about-barrier-options"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://luca-bressan.github.io/about-barrier-options"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <!--<section class="copyright"><a href="http://localhost:4000/">Luca Bressan - finance & statistics</a> &copy; 2022</section>-->
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2. </a>
                    Photos courtesy of <a href="https://unsplash.com/" target="_blank" rel="noopener">Unsplash</a>.
                </section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    <a href="https://linkedin.com/in/lbressan" target="_blank" rel="noopener">Linkedin</a>
                    <a href="https://github.com/luca-bressan" target="_blank" rel="noopener">GitHub</a>
                    <!--<a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>-->
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    


    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>



    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!--
-->

    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
